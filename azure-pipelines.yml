trigger:
- main

variables:
  solution: '**/*.sln'
  buildPlatform: 'Any CPU'
  buildConfiguration: 'Release'
  dockerHubUsername: 'phucnghi'
  dockerHubImageName: 'phucnghi/thrivohr'
  dockerfilePath: '**/Dockerfile'
  tag: '$(Build.BuildId)'

stages:
- stage: Deploy
  displayName: Deploy to VPS
  jobs:
  - deployment: Deploy
    displayName: Deploy to VPS
    environment: 'production'
    pool:
      name: 'VPS'  # Replace 'Default' with your self-hosted agent pool name
    strategy:
      runOnce:
        deploy:
          steps:
          - task: SSH@0
            inputs:
              sshEndpoint: 'vpsConnection'
              runOptions: 'inline'
              inline: |
                docker pull phucnghi/thrivohr:latest
                docker stop exe201_be_thrivohr || true
                docker rm exe201_be_thrivohr || true
                docker run -d --name exe201_be_thrivohr -p 80:80 phucnghi/ThrivoHR:$(tag)
                docker image prune -f