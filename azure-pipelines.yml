trigger:
  branches:
    include:
      - main  # Trigger on pushes to the main branch

pool:
  name: 'VPS'  # Ensure the correct pool name if using a self-hosted agent

steps:
  # Pull the latest code on your VPS
  - task: SSH@0
    inputs:
      sshEndpoint: 'vpsConnection'  # Define your SSH connection to the VPS in Azure DevOps
      runOptions: 'commands'
      commands: |
        cd /home/phucnghi/thrivohr/EXE201_BE_THRIVOHR && git pull origin main  # Combine commands
    displayName: 'Pull latest code from repository'

  # Run docker-compose on VPS
  - task: SSH@0
    inputs:
      sshEndpoint: 'vpsConnection'
      runOptions: 'commands'
      commands: |
        cd /home/phucnghi/thrivohr/EXE201_BE_THRIVOHR && \
        docker-compose pull && \
        docker-compose build && \
        docker-compose up -d  # Start the container in detached mode
    displayName: 'Run docker-compose'
  
  # Verify if the container is running
  - task: SSH@0
    inputs:
      sshEndpoint: 'vpsConnection'
      runOptions: 'commands'
      commands: |
        cd /home/phucnghi/thrivohr/EXE201_BE_THRIVOHR && docker-compose ps  # Check running containers
    displayName: 'Verify running containers'
