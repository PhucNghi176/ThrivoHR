trigger:
  branches:
    include:
      - main  # Trigger on pushes to the main branch

pool:
  name: 'VPS'  # Ensure the correct pool name if using a self-hosted agent

steps:
  # Stop the current Docker container and pull the latest code on your VPS
  - task: SSH@0
    inputs:
      sshEndpoint: 'vpsConnection'
      runOptions: 'commands'
      commands: |
        cd /home/phucnghi/thrivohr/EXE201_BE_THRIVOHR
        docker compose down && \
        docker compose build && \
        docker compose up -d
    displayName: 'Stop current container and run docker-compose'

  # Verify if the container is running
  - task: SSH@0
    inputs:
      sshEndpoint: 'vpsConnection'
      runOptions: 'commands'
      commands: |
        cd /home/phucnghi/thrivohr/EXE201_BE_THRIVOHR && docker compose ps
    displayName: 'Verify running containers'